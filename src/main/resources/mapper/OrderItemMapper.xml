<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.cloneproject.demo.orderItem.repository.OrderItemRepository">

  <!-- 주문 항목 삭제 -->
  <delete id="deleteById" parameterType="long">
    DELETE
    FROM order_item
    WHERE id = #{id}
  </delete>

  <!-- 키워드 검색 (회원 ID 기준 order_group → order_item 조인) -->
  <select id="searchByProductName"
    parameterType="map"
    resultType="com.cloneproject.demo.orderItem.OrderItem">
    SELECT oi.*
    FROM order_item oi
           JOIN order_group og ON oi.order_id = og.id
    WHERE og.member_id = #{memberId}
      AND oi.product_name LIKE CONCAT('%', #{keyword}, '%')
  </select>

  <!-- 주문 ID 기준 주문 항목 조회 -->
  <select id="findByOrderId" parameterType="long"
    resultType="com.cloneproject.demo.orderItem.OrderItem">
    SELECT *
    FROM order_item
    WHERE order_id = #{orderId}
  </select>

  <!-- 주문 상태 변경 -->
  <update id="updateStatus" parameterType="map">
    UPDATE order_item
    SET status     = #{status},
        updated_at = NOW()
    WHERE id = #{id}
  </update>

</mapper>